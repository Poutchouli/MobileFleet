{% extends "integration/base.html" %}
{% block title %}Numéros de Téléphone{% endblock %}
{% block page_title %}Numéros de Téléphone{% endblock %}

{% block content %}
<div class="custom-card max-w-2xl mx-auto">
    <div class="card-header">
        <h2 class="card-title">Demander un Téléphone pour un Employé</h2>
    </div>
    <form id="request-form" class="p-4">
        <div class="space-y-4">
            <div class="custom-form-group">
                <label for="employee-name" class="custom-label">Nom Complet de l'Employé*</label>
                <input type="text" id="employee-name" name="employee_name" required class="custom-input" placeholder="Entrez le nom complet de l'employé">
            </div>
            
            <div class="custom-form-group">
                <label for="department" class="custom-label">Département*</label>
                <input type="text" id="department" name="department" required class="custom-input" placeholder="ex: Ventes, Ingénierie, Opérations">
            </div>
            
            <div class="custom-form-group">
                <label for="position" class="custom-label">Poste/Rôle*</label>
                <input type="text" id="position" name="position" required class="custom-input" placeholder="ex: Représentant des Ventes, Développeur de Logiciels">
            </div>
            
            <div class="custom-form-group">
                <label for="request-reason" class="custom-label">Raison de la Demande*</label>
                <textarea id="request-reason" name="request_reason" required rows="3" class="custom-textarea" placeholder="Veuillez expliquer pourquoi cet employé a besoin d'un téléphone (ex: nouvel employé, remplacement, mise à niveau)"></textarea>
            </div>
            
            <div class="custom-form-group">
                <label for="phone-type" class="custom-label">Préférence de Type de Téléphone</label>
                <select id="phone-type" name="phone_type_preference" class="custom-select">
                    <option value="">Aucune préférence</option>
                    <option value="iPhone">iPhone</option>
                    <option value="Samsung Galaxy">Samsung Galaxy</option>
                    <option value="Google Pixel">Google Pixel</option>
                    <option value="Any Android">N'importe quel appareil Android</option>
                    <option value="Basic Phone">Téléphone Assigné</option>
                </select>
            </div>
            
            <div class="custom-form-group">
                <label for="urgency-level" class="custom-label">Niveau d'Urgence*</label>
                <select id="urgency-level" name="urgency_level" required class="custom-select">
                    <option value="">Sélectionnez le niveau d'urgence...</option>
                    <option value="Low">Faible - Peut attendre 2+ semaines</option>
                    <option value="Medium">Moyen - Nécessaire dans 1-2 semaines</option>
                    <option value="High">Élevé - Nécessaire dans quelques jours</option>
                    <option value="Critical">Critique - Nécessaire immédiatement</option>
                </select>
            </div>
        </div>
        
        <div class="custom-modal-footer">
            <button type="button" onclick="window.location.href='{{ url_for('integration_dashboard') }}'" class="btn btn-secondary">Annuler</button>
            <button type="submit" class="btn btn-primary">Soumettre la Demande</button>
        </div>
    </form>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const requestForm = document.getElementById('request-form');
        
        requestForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(requestForm);
            const requestData = Object.fromEntries(formData.entries());

            // Basic validation
            if (!requestData.employee_name.trim()) {
                alert('Veuillez saisir le nom de l\'employé.');
                return;
            }
            
            if (!requestData.department.trim()) {
                alert('Veuillez saisir le département.');
                return;
            }
            
            if (!requestData.position.trim()) {
                alert('Veuillez saisir le poste.');
                return;
            }
            
            if (!requestData.request_reason.trim()) {
                alert('Veuillez fournir une raison pour la demande.');
                return;
            }
            
            if (!requestData.urgency_level) {
                alert('Veuillez sélectionner un niveau d\'urgence.');
                return;
            }

            try {
                const response = await fetch('/api/integration/requests', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestData)
                });
                
                const result = await response.json();
                if (!response.ok) throw new Error(result.error || 'Failed to submit request');
                
                alert('Demande de téléphone soumise avec succès !');
                window.location.href = "{{ url_for('integration_dashboard') }}";
            } catch (error) {
                console.error('Error submitting request:', error);
                alert(`Erreur: ${error.message}`);
            }
        });
    });
</script>
{% endblock %}
